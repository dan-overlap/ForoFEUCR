!function(e){e.fn.extend({reflect:function(t){return t=e.extend({height:1/3,opacity:.5},t),this.unreflect().each(function(){function a(){var a,r,s,c,n,o=i.width,l=i.height;if(r=Math.floor(t.height>1?Math.min(l,t.height):l*t.height),a=e("<canvas />")[0],a.getContext){c=a.getContext("2d");try{e(a).attr({width:o,height:r}),c.save(),c.translate(0,l-1),c.scale(1,-1),c.drawImage(i,0,0,o,l),c.restore(),c.globalCompositeOperation="destination-out",n=c.createLinearGradient(0,0,0,r),n.addColorStop(0,"rgba(255, 255, 255, "+(1-t.opacity)+")"),n.addColorStop(1,"rgba(255, 255, 255, 1.0)"),c.fillStyle=n,c.rect(0,0,o,r),c.fill()}catch(e){return}}else{if(!window.ActiveXObject)return;a=e("<img />").attr("src",i.src).css({width:o,height:l,marginBottom:r-l,filter:"FlipV progid:DXImageTransform.Microsoft.Alpha(Opacity="+100*t.opacity+", FinishOpacity=0, Style=1, StartX=0, StartY=0, FinishX=0, FinishY="+r/l*100+")"})[0]}e(a).css({display:"block",border:0}),s=e(/^a$/i.test(i.parentNode.tagName)?"<span />":"<div />").insertAfter(i).append([i,a])[0],s.className=i.className,e.data(i,"reflected",s.style.cssText=i.style.cssText),e(s).css({width:o,height:l+r,overflow:"hidden"}),i.style.cssText="display: block; border: 0px",i.className="reflected"}var i=this;/^img$/i.test(i.tagName)&&(i.complete?a():e(i).load(a))})},unreflect:function(){return this.unbind("load").each(function(){var t,a=this,i=e.data(this,"reflected");i!==undefined&&(t=a.parentNode,a.className=t.className,a.style.cssText=i,e.removeData(a,"reflected"),t.parentNode.replaceChild(a,t))})}})}(jQuery),jQuery(function(e){e("img.reflect").reflect({})});